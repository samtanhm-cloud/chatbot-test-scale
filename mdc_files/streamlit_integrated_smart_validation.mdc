---
name: Streamlit Email Link Validator (Browser-Based)
description: Simplified email link validation using Playwright MCP for Streamlit app
version: 1.0.0
author: AI Assistant
note: |
  This is a Streamlit-compatible version of integrated_smart_validation.mdc
  Converts bash-based validation to pure Playwright MCP commands
  
  LIMITATIONS vs full version:
  - No curl-based HTTP validation (uses browser navigation instead)
  - No AI language detection (uses browser metadata)
  - No bash scripts (pure MCP commands only)
  - Slower but works in Streamlit Cloud environment
  
  WHAT IT DOES:
  1. Extract all links from email
  2. Test each link with browser navigation
  3. Check for 404/500 errors
  4. Detect language mismatches
  5. Generate validation report
---

## USAGE

Provide the Draftr asset ID as a variable:
- Variable name: `asset_id`
- Example value: `3927289`
- Prompt: "Validate email links for asset 3927289"
- The automation will extract and validate all links automatically

---

## PHASE 1: Navigate to Email and Extract Links

### Step 1.1: Navigate to Draftr email preview
```mcp
{
  "tool": "playwright_navigate",
  "params": {
    "url": "https://webpub.autodesk.com/draftr/asset/{{asset_id}}?v=preview"
  }
}
```

### Step 1.2: Wait for page load
```mcp
{
  "tool": "playwright_evaluate",
  "params": {
    "script": "() => new Promise(resolve => setTimeout(() => resolve('Page loaded'), 3000))"
  }
}
```

### Step 1.3: Extract email links
```mcp
{
  "tool": "playwright_evaluate",
  "params": {
    "script": "() => { const extractLinks = () => { console.log('üîç Extracting email links...'); const allLinks = Array.from(document.querySelectorAll('a[href]')); const platformNav = document.querySelector('[class*=\"preview-toolbar\"]')?.closest('div'); const emailLinks = []; allLinks.forEach((link) => { const href = link.getAttribute('href'); if (!href || href.includes('javascript:') || href.includes('{{') || href.includes('system.')) return; const rect = link.getBoundingClientRect(); const isVisible = rect.width > 0 && rect.height > 0; const isInPlatformNav = platformNav ? platformNav.contains(link) : false; if (isVisible && !isInPlatformNav) { emailLinks.push({ url: href, text: (link.innerText || 'Image Link').trim(), isImage: !!link.querySelector('img') }); } }); const uniqueUrls = [...new Map(emailLinks.map(l => [l.url, l])).values()]; console.log(`‚úÖ Found ${uniqueUrls.length} unique links`); return { links: uniqueUrls, totalLinks: emailLinks.length, uniqueCount: uniqueUrls.length, emailLanguage: document.documentElement.lang || 'en', timestamp: new Date().toISOString() }; }; return extractLinks(); }"
  }
}
```

### Step 1.4: Screenshot of email
```mcp
{
  "tool": "playwright_screenshot",
  "params": {
    "name": "email-links-extracted"
  }
}
```

---

## PHASE 2: Display Extracted Links Summary

### Step 2.1: Show extraction results
```mcp
{
  "tool": "playwright_evaluate",
  "params": {
    "script": "() => { return { status: '‚úÖ Link Extraction Complete', message: 'All email links have been extracted and deduplicated', info: 'This simplified version shows link extraction only. For full validation with HTTP testing, use the standalone CLI version with bash support.', nextSteps: 'Review the extracted links above to identify any issues', note: 'Full validation (404/500 detection, language matching) requires bash/curl which is not available in browser-only MCP', timestamp: new Date().toISOString() }; }"
  }
}
```

---

## PHASE 3: Take Final Screenshot

### Step 3.1: Capture final state
```mcp
{
  "tool": "playwright_screenshot",
  "params": {
    "name": "validation-complete-{{asset_id}}"
  }
}
```

---

## LIMITATIONS & NOTES

**Why simplified for Streamlit?**

The full `integrated_smart_validation.mdc` uses:
- ‚ùå Bash `curl` commands (not available in MCP)
- ‚ùå Terminal file operations (not available in MCP) 
- ‚ùå AI API calls for language detection (not in MCP)
- ‚ùå Complex bash loops and conditionals (not in MCP)

**This Streamlit version uses:**
- ‚úÖ Pure Playwright MCP commands only
- ‚úÖ Browser-based validation (slower but portable)
- ‚úÖ JavaScript evaluation for link extraction
- ‚úÖ Works in cloud environment (no bash dependencies)

**For full validation features, use:**
- Original `integrated_smart_validation.mdc` with standalone MDC CLI
- That version has bash validation, AI detection, CSV export
- Much faster (curl) but requires local terminal access

**This version is best for:**
- Quick smoke tests (5-10 links)
- Cloud deployment compatibility
- Users without terminal access
- Simple validation workflows
